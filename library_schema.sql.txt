-- ========================================
-- Library Management System - Example DB
-- ========================================

-- Books table
CREATE TABLE books (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author VARCHAR(255),
    genre VARCHAR(100),
    published_year INT,
    total_copies INT DEFAULT 1
);

-- Example book data
INSERT INTO books (title, author, genre, published_year, total_copies)
VALUES
('The Hobbit', 'J.R.R. Tolkien', 'Fantasy', 1937, 5),
('1984', 'George Orwell', 'Dystopian', 1949, 3),
('To Kill a Mockingbird', 'Harper Lee', 'Classic', 1960, 4),
('The Great Gatsby', 'F. Scott Fitzgerald', 'Classic', 1925, 2),
('Python Crash Course', 'Eric Matthes', 'Programming', 2016, 6);

-- Students table (anonymized)
CREATE TABLE students (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    enrolled_date DATE DEFAULT CURRENT_DATE
);

INSERT INTO students (name, email)
VALUES
('Student1', 'student1@example.com'),
('Student2', 'student2@example.com'),
('Student3', 'student3@example.com');

-- Issued books table (empty, for safe example)
CREATE TABLE issued_books (
    id SERIAL PRIMARY KEY,
    student_id INT REFERENCES students(id) ON DELETE CASCADE,
    book_id INT REFERENCES books(id) ON DELETE CASCADE,
    issue_date DATE DEFAULT CURRENT_DATE,
    return_date DATE,
    returned BOOLEAN DEFAULT FALSE,
    penalty NUMERIC(6, 2)
);

-- Admin users table (placeholder)
CREATE TABLE admin_users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL
);

INSERT INTO admin_users (username, password_hash)
VALUES ('admin', 'example_hashed_password');

-- Example view for issued books summary
CREATE VIEW issued_summary AS
SELECT
    s.name AS student,
    b.title AS book,
    i.issue_date,
    i.return_date,
    i.returned,
    i.penalty
FROM issued_books i
JOIN students s ON i.student_id = s.id
JOIN books b ON i.book_id = b.id;

-- Sample SELECT queries for reference
-- SELECT * FROM books;
-- SELECT * FROM students;
-- SELECT * FROM issued_books;
-- SELECT * FROM admin_users;
-- SELECT * FROM issued_summary;
